{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["ListaNegociacoes","Mensagem","NegociacoesView","MensagemView","NegociacaoService","DateHelper","Bind","Negociacao","NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_listaNegociacoes","_mensagem","_ordemAtual","_negociacaoService","_init","lista","then","negociacoes","forEach","adiciona","negociacao","catch","texto","erro","setInterval","_importaNegociacoes","event","preventDefault","_criaNegociacao","cadastra","mensagem","_limpaFormulario","importa","apaga","esvazia","textoParaData","value","parseInt","parseFloat","focus","coluna","inverterOrdem","ordena","a","b","negociacaoController","currentInstance"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import {ListaNegociacoes} from '../models/ListaNegociacoes';\nimport {Mensagem} from '../models/Mensagem';\nimport {NegociacoesView} from '../views/NegociacoesView';\nimport {MensagemView} from '../views/MensagemView';\nimport {NegociacaoService} from '../services/NegociacaoService';\nimport {DateHelper} from '../helper/DateHelper';\nimport {Bind} from '../helper/Bind';\nimport {Negociacao} from '../models/Negociacao';\n\nclass NegociacaoController {\n\n  constructor() { \n\n      let $ = document.querySelector.bind(document);\n      this._inputData = $('#data');\n      this._inputQuantidade = $('#quantidade');\n      this._inputValor = $('#valor');\n      \n      this._listaNegociacoes = new Bind(new ListaNegociacoes(),\n                                        new NegociacoesView($('#negociacoesView')),\n                                        'adiciona', 'esvazia', 'ordena', 'inverterOrdem');\n\n      this._mensagem = new Bind(new Mensagem,\n                                new MensagemView($('#mensagemView')),\n                                'texto');\n      this._ordemAtual = '';\n\n      this._negociacaoService = new NegociacaoService();\n\n      this._init();\n  }\n\n  _init() {\n\n    this._negociacaoService\n        .lista()\n        .then(negociacoes => \n            negociacoes.forEach(negociacao => \n              this._listaNegociacoes.adiciona(negociacao)))\n        .catch(erro => this._mensagem.texto = erro);\n\n    setInterval(() => {\n\n      this._importaNegociacoes();\n\n    },3000);\n  }\n\n  adiciona(event) {\n\n      event.preventDefault();\n      \n      let negociacao = this._criaNegociacao();\n\n      this._negociacaoService\n        .cadastra(negociacao)\n        .then(mensagem => {\n          this._listaNegociacoes.adiciona(negociacao);\n          this._mensagem.texto = mensagem;\n          this._limpaFormulario();\n        })\n        .catch(erro =>this._mensagem.texto = erro);\n  }\n\n  _importaNegociacoes() {\n    \n      this._negociacaoService\n        .importa(this._listaNegociacoes.negociacoes)\n        .then(negociacoes => negociacoes.forEach(negociacao =>  {\n              this._listaNegociacoes.adiciona(negociacao);\n              this._mensagem.texto = 'Negociações importadas com sucesso!';\n        }))\n        .catch(erro => this._mensagem.texto = erro);\n  }\n\n  apaga() {\n\n      this._negociacaoService\n          .apaga()\n          .then(mensagem => {\n             this._mensagem.texto = mensagem;\n             this._listaNegociacoes.esvazia();\n          })\n          .catch(erro => this._mensagem.texto = erro);\n  }\n\n  _criaNegociacao() {\n\n      return new Negociacao(\n            DateHelper.textoParaData(this._inputData.value),\n            parseInt(this._inputQuantidade.value),\n            parseFloat(this._inputValor.value));\n  }\n\n  _limpaFormulario() {\n\n      this._inputData.value = '';\n      this._inputQuantidade.value = 1;\n      this._inputValor.value = 0.0;\n\n      this._inputData.focus();\n  }\n\n  ordena(coluna) {\n\n    if(this._ordemAtual == coluna) {\n      \n      this._listaNegociacoes.inverterOrdem();\n    } else {\n\n      this._listaNegociacoes.ordena((a, b) => a[coluna] - b[coluna]);\n    }\n\n    this._ordemAtual = coluna;\n  }\n\n}\n\nlet negociacaoController = new NegociacaoController();\n\nexport function currentInstance() {\n\n  return negociacaoController;\n\n}"]}